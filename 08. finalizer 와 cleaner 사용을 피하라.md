# finalizer 와 cleaner 사용을 피하라

자바는 두 가지 객체 소멸자를 제공한다. 그 중 `finalizer` 는 예측할 수 없고, 상황에 따라 위험할 수 있어 일반적으로 불필요하다. 오동작 낮은 성능, 이식성이 문제의 원인이 되기도 한다.
`cleaner` 또한 finalizer 보단 덜 위험하지만 여전히 예측할 수 없고, 느리고 일반적으로 불필요하다.

- `finalizer 와 cleaner 의 정리`
  - 둘 다 예측 불가능하고, 느리고 위험하다.
  - finalizer 와 cleaner 는 즉시 수행된 보장이 없어서 제때 실행되어야 하는 작업은 절대 할 수 없다.
    - ex) 파일 닫기를 finalizer 나 cleaner 에게 맡기면 중대한 오류를 일으킬 수 있다.
  - 자바 언어 명세는 finalizer 나 cleaner 의 수행 시점뿐 아니라 여부조차 보장하지 않는다.
  - 상태를 영구적으로 수정하는 작업에서는 절대 사용하면 안된다.
  - 심각한 성능 문제를 동반한다.
  - finalizer 를 사용한 클래스는 finalizer 공격에 노출되어 심각한 보안 문제를 일으킬 수도 있다.
    - finzlier 공격 원리 : 생성자나 직렬화 과정에서 예외가 발생하면, 이 생성되다 만 객체에서 악의적인 하위 클래스의 finalizer 가 수행될 수 있게 된다.
  - final 이 아닌 클래스를 finalizer 공격으로부터 방어하려면 아무일 도 하지 않는 finalize 메서드를 만들고 final 을 선언하자.
  - 그렇다면 파일이나 스레드 등 종료해야 할 자원을 담고 있는 객체의 클래스에서 finalizer 나 cleaner 를 대신해줄 묘안은 무엇일까?
    - 그저 `AutoCloseable`을 구현해주고, 클라이언트에서 인스턴스를 다 쓰고 나면 `close` 메서드를 호출하면 된다.
    - 다른 메서드에서 필드를 검사해 객체가 닫힌 후에 불렸다면, `IllegalStateException`을 던지면 된다.
    
 > cleaner 는 안전망 역할이나 중요하지 않은 네이티브 자원 회수용으로만 사용해야 한다. 이러한 경우라도 불확실성과 성능 저하는 일어난다.

